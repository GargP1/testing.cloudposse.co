version: 2

projects:

- name: "tfstate-backend"
  workflow: "make"
  dir: "conf/tfstate-backend"
  workspace: "default"
  terraform_version: "v0.11.10"
  autoplan:
    when_modified:
      - "Makefile*"
      - "*.tf"
      - "*.tfvars"
      - ".envrc"
    enabled: true
  apply_requirements:
    - "approved"

workflows:
  make:
    plan:
      steps:
        - run: "make reset"
        - run: "make deps"
        - run: "make plan | scenery --no-color"
    apply:
      steps:
        - run: "make apply"
